# Tomcat任意文件上传

### 影响范围:Apache Tomcat 7.0.0 - 7.0.79（7.0.81修复不完全）

当 Tomcat 运行在 Windows 主机上，且启用了 HTTP PUT 请求方法（例如，将 readonly 初始化参数由默认值设置为 false），攻击者将有可能可通过精心构造的攻击请求向服务器上传包含任意代码的 JSP 文件。之后，JSP 文件中的代码将能被服务器执行。
经过实际测试，Tomcat 7.x版本内web.xml配置文件内默认配置无readonly参数，需要手工添加，默认配置条件下不受此漏洞影响。

```bash
root@00575daee9e8:/usr/local/tomcat# cat conf/web.xml | grep readonly
  <!--   readonly            Is this context "read only", so HTTP           -->
<init-param><param-name>readonly</param-name><param-value>false</param-value></init-param>
```

打开网站

![image-20240920144847581](C:\Users\asus\AppData\Roaming\Typora\typora-user-images\image-20240920144847581.png)



利用put方法将jsp木马上传

![image-20240920145128265](C:\Users\asus\AppData\Roaming\Typora\typora-user-images\image-20240920145128265.png)

发现后台已经有了木马文件

![image-20240920145207855](C:\Users\asus\AppData\Roaming\Typora\typora-user-images\image-20240920145207855.png)

用冰蝎进行连接

![image-20240920145329105](C:\Users\asus\AppData\Roaming\Typora\typora-user-images\image-20240920145329105.png)

## poc：使用方法

python3 CVE-2017-12615.py -u (URL) -p (port) -f (file)
